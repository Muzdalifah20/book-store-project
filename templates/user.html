<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

</head>
<body>

    <header>
           <div class="first-bar">
          <div class="log">
            <a href="/login">LogIn</a>

            

            <a href="/register">SignUp</a>
          </div>
          <div class="logo">
            <i class="fa-solid fa-book-open-reader"></i>
          </div>
          <!-- <div class="search">
            <input type="search" placeholder="Search all books...">
          </div> -->
           
        </div>
        <nav class="nav-bar">
          <ul>
            <li><a href="/cart">Cart</a></li>
            <li>
                 <form action="/logout" method="get">
                    <input type="submit" value="log out">
                </form>
            </li>
          </ul>
        </nav>
      </header>
    
   <main>
      
    <section class="book">
        <div id="books-container"></div>
    </section>
 
   
   <script>
//     

function attachAddToCartListeners() {
   
    // Attach event listeners to all add-to-cart buttons
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
      button.addEventListener('click', async (event) => {
        event.preventDefault()
        const bookId = button.getAttribute('data-book-id');

        // Show confirmation dialog
      const confirmed = confirm("Do you want to add this item to your cart?");
      if (!confirmed) {
        // User clicked "Cancel", stop the addition
        return;
      }

        try {
          const response = await fetch(`/cart/add/${bookId}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            }
          });

          if (response.ok) {
             const data = await response.json();
          alert(data.message);  // Show alert on the same page
            // Optionally update cart UI or cart count here without page reload
          } else {
            alert('Failed to add item to cart.');
          }
        } catch (error) {
          console.error('Error adding to cart:', error);
          alert('An error occurred.');
        }
      });
    });
  
}  

async function loadBooks() {
  const container = document.getElementById('books-container');
  try {
    const res = await fetch('/api/books');
    const books = await res.json();
    container.innerHTML = '';
    books.forEach(book => {
      const div = document.createElement('div');
      div.innerHTML = `
        <h3>${book.title}</h3>
        <p>Price: $${book.price}</p>
        
          <button class="add-to-cart-btn" data-book-id="${book.book_id}">Add to Cart</button>


        
      `;
      container.appendChild(div);
    });

    attachAddToCartListeners(); // Attach listeners after buttons are created
  } catch {
    container.textContent = 'Failed to load books.';
  }
}

loadBooks();
   </script>

  
    
</body>
</html>